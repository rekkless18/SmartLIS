# SmartLIS 生产环境配置指南

## 概述

本文档详细说明了 SmartLIS 系统在生产环境中需要配置的环境变量，包括正确的填写方式和注意事项。

## 环境变量配置文件

### 1. 前端环境变量 (frontend/.env.production)

```bash
# API 基础地址 - 生产环境使用相对路径
VITE_API_BASE_URL=/api

# Supabase 配置 (如果使用)
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-supabase-anon-key

# 应用配置
VITE_APP_TITLE=SmartLIS
VITE_APP_VERSION=1.0.0

# 环境标识
VITE_NODE_ENV=production
```

### 2. 后端环境变量 (backend/.env)

```bash
# 服务器配置
PORT=3000
NODE_ENV=production

# 数据库配置 (Supabase)
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key
SUPABASE_ANON_KEY=your-supabase-anon-key

# JWT 配置
JWT_SECRET=your-super-secure-jwt-secret-key-here
JWT_EXPIRES_IN=24h

# CORS 配置
CORS_ORIGIN=https://your-domain.com

# 日志配置
LOG_LEVEL=info

# 安全配置
BCRYPT_ROUNDS=12
```

### 3. Docker 环境变量 (docker-compose.yml)

```yaml
environment:
  - NODE_ENV=production
  - PORT=3000
  - SUPABASE_URL=https://your-project.supabase.co
  - SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key
  - SUPABASE_ANON_KEY=your-supabase-anon-key
  - JWT_SECRET=your-super-secure-jwt-secret-key-here
  - JWT_EXPIRES_IN=24h
  - CORS_ORIGIN=https://your-domain.com
  - LOG_LEVEL=info
  - BCRYPT_ROUNDS=12
```

## 配置说明

### 前端配置详解

#### VITE_API_BASE_URL
- **用途**: 前端调用后端 API 的基础地址
- **生产环境值**: `/api`
- **说明**: 使用相对路径，通过 Docker 容器内部网络或反向代理访问后端
- **错误示例**: `http://localhost:3000/api` (仅适用于开发环境)

#### VITE_SUPABASE_URL
- **用途**: Supabase 项目的 URL
- **格式**: `https://your-project-id.supabase.co`
- **获取方式**: 在 Supabase 控制台的项目设置中查看

#### VITE_SUPABASE_ANON_KEY
- **用途**: Supabase 匿名访问密钥
- **安全级别**: 可以暴露在前端代码中
- **获取方式**: 在 Supabase 控制台的 API 设置中查看

### 后端配置详解

#### PORT
- **用途**: 后端服务监听端口
- **生产环境值**: `3000`
- **说明**: 与 Docker 容器端口映射保持一致

#### NODE_ENV
- **用途**: Node.js 环境标识
- **生产环境值**: `production`
- **影响**: 启用生产优化、禁用调试信息

#### SUPABASE_SERVICE_ROLE_KEY
- **用途**: Supabase 服务角色密钥
- **安全级别**: 高度敏感，绝不能暴露在前端
- **权限**: 拥有数据库的完全访问权限
- **获取方式**: 在 Supabase 控制台的 API 设置中查看

#### JWT_SECRET
- **用途**: JWT 令牌签名密钥
- **要求**: 至少 32 位的随机字符串
- **生成方式**: 使用 `openssl rand -base64 32` 或在线生成器
- **安全性**: 极其重要，泄露会导致安全漏洞

#### CORS_ORIGIN
- **用途**: 跨域资源共享配置
- **生产环境值**: 前端域名，如 `https://your-domain.com`
- **多域名**: 使用逗号分隔，如 `https://domain1.com,https://domain2.com`

## 安全最佳实践

### 1. 敏感信息管理
- 使用强密码和随机密钥
- 定期轮换密钥
- 不要在代码中硬编码敏感信息
- 使用环境变量或密钥管理服务

### 2. 访问控制
- 限制 CORS 源到特定域名
- 使用 HTTPS 加密传输
- 配置适当的 JWT 过期时间

### 3. 监控和日志
- 设置适当的日志级别
- 监控异常访问和错误
- 定期检查安全日志

## 部署检查清单

### 部署前检查
- [ ] 所有环境变量已正确配置
- [ ] 敏感信息已使用强密钥
- [ ] CORS 配置限制到生产域名
- [ ] 数据库连接测试通过
- [ ] JWT 密钥已生成并配置

### 部署后验证
- [ ] 前端可以正常访问
- [ ] API 接口响应正常
- [ ] 用户登录功能正常
- [ ] 数据库操作正常
- [ ] 日志记录正常

## 常见问题

### Q: 前端显示网络错误或超时
**A**: 检查 `VITE_API_BASE_URL` 是否配置为 `/api`，确保不是 `localhost` 地址。

### Q: 后端无法连接数据库
**A**: 检查 Supabase URL 和密钥是否正确，网络是否可达。

### Q: JWT 令牌验证失败
**A**: 确保前后端使用相同的 `JWT_SECRET`，检查密钥是否正确配置。

### Q: CORS 错误
**A**: 检查 `CORS_ORIGIN` 是否包含前端域名，确保协议（http/https）匹配。

## 环境变量模板

### 快速配置模板

创建 `frontend/.env.production`:
```bash
VITE_API_BASE_URL=/api
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-supabase-anon-key
```

创建 `backend/.env`:
```bash
PORT=3000
NODE_ENV=production
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key
SUPABASE_ANON_KEY=your-supabase-anon-key
JWT_SECRET=your-super-secure-jwt-secret-key-here
JWT_EXPIRES_IN=24h
CORS_ORIGIN=https://your-domain.com
LOG_LEVEL=info
BCRYPT_ROUNDS=12
```

## 更新记录

- **2025-01-20**: 创建初始版本
- **作者**: Erikwang
- **版本**: 1.0.0

---

**注意**: 请根据实际的生产环境情况调整配置值，确保所有敏感信息的安全性。